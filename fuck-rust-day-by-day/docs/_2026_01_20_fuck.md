这是一个非常专业的问题。你看到的数据库字段和逻辑，属于交易系统后端核心的**清算（Clearing）**或**资产（Ledger）**逻辑。

这里存在一个**“用户视图”**和**“系统内部记账视图”**的差异。你之所以感到困惑，是因为你看到的 `after_amount` 并不是用户界面上显示的“钱包余额”，而是一个系统内部的核算字段。

根据你提供的 JSON 数据和交易参数，我为你详细推导整个计算过程。

### 1. 结论先行：你的账户当前状态

基于你提供的数据和当前标记价格（3184.47），你的账户真实状态如下：

* **钱包余额 (Wallet Balance):** `998.089624` USDT
* **未结盈亏 (Unrealized PnL):** `+0.51` USDT
* **账户权益 (Equity):** `998.599624` USDT

---

### 2. 数据库字段深度解码

让我们先解开你最疑惑的那个数据库字段 `after_amount` 的计算逻辑。

#### 关键字段分析

在你的 JSON `data` 中，有这样几个关键数值：

* **`fill_value` (成交价值)**: `3183.96` (即 1 ETH * 3183.96)
* **`fill_fee` (手续费)**: `1.910376`
* **`delta_amount` (变动额)**: `-3185.870376`
* **`after_amount` (变动后额)**: `-2185.870376`
* **`after_legacy_amount` (遗留金额/真实余额)**: `998.089624`

#### 秘密公式：为什么是 -3185.870376？

这个系统在 `t_collateral_transaction` 表中记录这笔“开仓（Type 7）”交易时，采用了一种**全额记账逻辑**（类似现货买入的记账方式，或者是系统内部为了校验资金流向的特殊记账）。

**`delta_amount` 的计算公式是：**


**`after_amount` 的计算公式是：**


**⚠️ 重点说明：**
这个 **`after_amount` (-2185.87...)** 是系统内部用来追踪“如果这是现货买入，你的现金流状况”或者用于内部对账的字段。**它不是你的钱包余额**，因为在合约交易中，你并没有真正花全款买下 ETH，你只是押注了保证金。

**你真正应该看的是 `after_legacy_amount` 字段：**


> **结论：** 数据库中的 `after_legacy_amount` `998.089624` 才是你真正的 **Wallet Balance**。

---

### 3. 详细计算过程推导

现在我们基于真实的 Wallet Balance 来计算你需要的所有数据。

#### 第一步：计算钱包余额 (Balance)

钱包余额只受**已结盈亏**和**手续费**影响，不受价格波动影响（除非扣资金费）。

* 初始资金：1000 USDT
* 开仓手续费：1.910376 USDT
* **当前余额** = 

#### 第二步：计算未结盈亏 (Unrealized PnL)

这是浮动的，取决于当前标记价格。

* 方向：做多 (+1)
* 持仓数量：1 ETH
* 开仓价格：3183.96
* 当前标记价格：3184.47
* **公式**：
* **计算**：

#### 第三步：计算账户权益 (Equity)

这是你现在立刻平仓能拿回的钱。

* **公式**：
* **计算**：

#### 第四步：补充计算 - 保证金占用 (Initial Margin)

为了让你更清楚风险，我们算一下保证金占用。

* 模式：全仓 (Cross)
* 杠杆：20倍
* 仓位价值：
* **起始保证金** = 

#### 第五步：补充计算 - 可用保证金 (Available Margin)

* **公式**：
* **计算**：

---

### 4. 总结

你在数据库中看到的负数 `after_amount` (-2185...) 是因为：
系统把 **"成交价值 (3183.96)"** 加 **"手续费 (1.91...)"** 一起作为负项记录在了 `delta_amount` 里。这通常是系统内部为了将“持仓成本”和“现金余额”做某种特殊的会计平衡，或者该表设计初衷包含了现货逻辑。

**对于你的合约账户业务逻辑，请只关注以下字段：**

1. **`after_legacy_amount`**: `998.089624` (这是你的 **Balance**)
2. **`fill_value`**: `3183.96` (这是你的开仓价值，用于计算盈亏)
3. **`fill_fee`**: `1.910376` (这是你的实际花费)

**最终结果：**

* **Balance**: `998.089624`
* **Equity**: `998.599624`