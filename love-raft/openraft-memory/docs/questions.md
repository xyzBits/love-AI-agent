# Raft 常见问题解答 (Q&A)

## 1. RaftService 中的核心接口功能是什么？

`RaftService` 中的这些接口是 Raft 共识算法的核心，专门用于**节点之间**的通信（内部通信），以保证分布式系统的数据一致性。

### `AppendEntries` (追加日志)
这是 Raft 中最繁忙、最重要的接口：
*   **日志复制**：由 Leader 调用，将新的业务操作（日志条目）发送给所有的 Follower 节点，确保大家的数据序列是一致的。
*   **心跳机制**：如果没有新的日志，Leader 也会定期发送空的 `AppendEntries` 请求。这告诉其他节点 Leader 还活着，防止它们发起新的选举。

### `Vote` (请求投票)
这个接口用于 **“选主”** 阶段：
*   当一个节点发现长时间没有收到 Leader 的心跳时，它会变成 **Candidate（候选人）**。
*   它会调用这个接口向集群中的其他节点发起投票请求。
*   如果它获得了超过半数的选票，它就会成为新的 Leader。

### `InstallSnapshot` (安装快照)
这个接口用于 **“状态同步”**：
*   当一个 Follower 节点由于宕机或网络问题导致进度落后太多，由于日志可能已经被 Leader 压缩删除，此时 Leader 会直接把当前的 **快照（数据的最终状态）** 直接发给这个 Follower。
*   Follower 接收并安装快照后，其状态机就能立即更新到较新的状态，从而能够继续接收后续的日志。

---

## 2. 这些接口能改用 HTTP 实现吗？

从技术角度来说，**完全可以**。Raft 协议本身是逻辑性的，它并不强制要求使用某种特定的网络协议。

### 为什么可以用 HTTP？
Raft 的核心是节点之间交换消息。你可以为每个接口定义一个 HTTP 路由，例如 `POST /raft/append_entries`。节点之间通过发送 JSON 或 Msgpack 格式的 POST 请求来完成通信。

### 为什么工业界（包括本项目）首选 gRPC？
虽然 HTTP 可以胜任，但 gRPC 在高频通信场景中有明显优势：

*   **性能更高**：使用 HTTP/2 和 Protobuf 二进制序列化，比 HTTP/1.1 + JSON 更快、占用带宽更少。
*   **流式传输 (Streaming)**：在传输大的 `InstallSnapshot` 文件时，gRPC 的流式特性处理起来更高效。
*   **强类型契约**：Protobuf 保证了不同节点之间通信的兼容性。
*   **长连接复用**：降低了频繁创建连接的开销。

### 总结
对于简单的演示，HTTP 是可行的；但在生产环境或高性能要求下，gRPC 是更专业、更通用的做法。
